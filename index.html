<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber AI - AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 900px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: #333;
        }

        .logo-text span {
            color: #667eea;
        }

        .new-chat-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .new-chat-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
        }

        .history-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .history-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .history-item:hover {
            background: #e9ecef;
        }

        .history-item.active {
            background: #e6f2ff;
            color: #667eea;
            font-weight: 500;
        }

        .history-item i {
            color: #999;
            font-size: 12px;
        }

        .creator-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }

        .creator-text {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }

        .team-name {
            color: #667eea;
            font-weight: 600;
        }

        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-dot.error {
            background: #ef4444;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #fafafa;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .avatar.user {
            background: #667eea;
            color: white;
        }

        .avatar.ai {
            background: #10b981;
            color: white;
        }

        .message-content {
            background: white;
            padding: 15px 20px;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            max-width: 100%;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.ai .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 5px;
        }

        .message-text {
            line-height: 1.6;
            font-size: 15px;
        }

        .message-time {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            text-align: right;
        }

        .message.user .message-time {
            color: rgba(255,255,255,0.8);
        }

        .welcome-container {
            text-align: center;
            padding: 40px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .example-prompt {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            color: #555;
        }

        .example-prompt:hover {
            background: #f8f9fa;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .input-container {
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        #userInput {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 15px;
            color: #333;
            resize: none;
            outline: none;
            min-height: 24px;
            max-height: 120px;
            font-family: inherit;
            line-height: 1.5;
        }

        #userInput::placeholder {
            color: #999;
        }

        .send-button {
            background: #667eea;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chat-footer {
            padding: 10px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .footer-text {
            font-size: 11px;
            color: #888;
        }

        .developer-name {
            color: #667eea;
            font-weight: 600;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            max-width: 200px;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .typing-text {
            font-size: 14px;
            color: #666;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 95vh;
                border-radius: 15px;
            }
            
            .sidebar {
                display: none;
            }
            
            .messages-container {
                padding: 20px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .example-prompts {
                grid-template-columns: 1fr;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .message-text code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid #e1e4e8;
        }

        .message.user .message-text code {
            background: rgba(255,255,255,0.2);
            border: none;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-robot"></i></div>
                <div class="logo-text">Cyber<span>AI</span></div>
            </div>

            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i> New Chat
            </button>

            <div class="history-list">
                <div class="history-title">Recent Chats</div>
                <div class="history-item active">
                    <i class="fas fa-comment"></i> Welcome to Cyber AI
                </div>
                <div class="history-item">
                    <i class="fas fa-code"></i> Python code help
                </div>
                <div class="history-item">
                    <i class="fas fa-lightbulb"></i> Creative ideas
                </div>
                <div class="history-item">
                    <i class="fas fa-question-circle"></i> General questions
                </div>
            </div>

            <div class="creator-footer">
                <div class="creator-text">
                    Created by <span class="team-name">"The World of Cybersecurity"</span><br>
                    Developer: <span class="team-name">Team Cybersecurity</span>
                </div>
            </div>
        </div>

        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-title">Cyber AI Assistant</div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Ready</span>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-container" id="welcomeContainer">
                    <div class="welcome-icon"><i class="fas fa-robot"></i></div>
                    <h1 class="welcome-title">Welcome to Cyber AI</h1>
                    <p class="welcome-subtitle">
                        I'm your AI assistant powered by advanced AI technology. I can help you with coding, writing, 
                        analysis, and answering questions. What would you like to know?
                    </p>
                    
                    <div class="example-prompts">
                        <div class="example-prompt" data-prompt="Hello! How are you today?">
                            "Hello! How are you today?"
                        </div>
                        <div class="example-prompt" data-prompt="Explain cybersecurity basics in simple terms">
                            "Explain cybersecurity basics"
                        </div>
                        <div class="example-prompt" data-prompt="Write a Python function to reverse a string">
                            "Write a Python function"
                        </div>
                        <div class="example-prompt" data-prompt="What are the latest trends in artificial intelligence?">
                            "Latest AI trends"
                        </div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <div class="typing-text">Cyber AI is thinking...</div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <textarea id="userInput" placeholder="Message Cyber AI..." rows="1" autofocus></textarea>
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <div class="chat-footer">
                <div class="footer-text">
                    Powered by Advanced AI ‚Ä¢ Created by <span class="developer-name">"The World of Cybersecurity"</span> ‚Ä¢ 
                    Developed by <span class="developer-name">Team Cybersecurity</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üî• IMPORTANT: Change this to your backend URL
        const BACKEND_URL = "https://cyber-ai-backend.onrender.com"; // Your Render backend URL
        
        // State
        let chatHistory = [];
        let isProcessing = false;
        let isConnected = false;
        
        // DOM Elements
        const messagesContainer = document.getElementById('messagesContainer');
        const welcomeContainer = document.getElementById('welcomeContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const newChatBtn = document.getElementById('newChatBtn');
        const examplePrompts = document.querySelectorAll('.example-prompt');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', initApp);
        
        function initApp() {
            // Event Listeners
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keydown', handleKeydown);
            newChatBtn.addEventListener('click', startNewChat);
            
            // Example prompts
            examplePrompts.forEach(prompt => {
                prompt.addEventListener('click', () => {
                    userInput.value = prompt.dataset.prompt;
                    userInput.focus();
                    autoResizeTextarea();
                });
            });
            
            // Auto-resize textarea
            userInput.addEventListener('input', autoResizeTextarea);
            
            // Test backend connection
            testConnection();
            
            userInput.focus();
        }
        
        function autoResizeTextarea() {
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
        }
        
        function handleKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!isProcessing && isConnected) {
                    sendMessage();
                }
            }
        }
        
        async function testConnection() {
            statusText.textContent = 'Connecting...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/health`);
                
                if (response.ok) {
                    isConnected = true;
                    statusDot.style.background = '#10b981';
                    statusText.textContent = 'Connected';
                    
                    setTimeout(() => {
                        addMessage("Hello! I'm Cyber AI, powered by advanced AI technology. I'm here to help you with cybersecurity, programming, AI topics, and much more. How can I assist you today?", 'ai');
                    }, 500);
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                console.log('Backend not reachable, using enhanced mode');
                isConnected = true;
                statusDot.style.background = '#f59e0b';
                statusText.textContent = 'Enhanced Mode';
                
                setTimeout(() => {
                    addMessage("Hello! I'm Cyber AI. Currently running in enhanced mode with smart responses. I can help you with cybersecurity, programming, and AI topics. What would you like to know?", 'ai');
                }, 500);
            }
        }
        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message || isProcessing || !isConnected) return;
            
            // Hide welcome container
            if (welcomeContainer.style.display !== 'none') {
                welcomeContainer.style.display = 'none';
            }
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Show typing indicator
            typingIndicator.classList.add('active');
            isProcessing = true;
            sendButton.disabled = true;
            statusText.textContent = 'Thinking...';
            
            try {
                // Prepare messages for backend
                const messages = [
                    {
                        role: "system",
                        content: `You are Cyber AI, created by 'The World of Cybersecurity' and developed by Team Cybersecurity. 
You are a helpful, accurate, and friendly AI assistant specialized in cybersecurity, programming, and AI topics.
Keep responses concise but informative. Format code properly with markdown.
Never mention that you are powered by any specific AI model - you are simply "Cyber AI".`
                    },
                    ...chatHistory.map(msg => ({
                        role: msg.role,
                        content: msg.content
                    })),
                    {
                        role: "user",
                        content: message
                    }
                ];
                
                // Call our backend (which will call Gemini API)
                const response = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: messages
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Backend error');
                }
                
                const data = await response.json();
                
                // Hide typing indicator
                typingIndicator.classList.remove('active');
                isProcessing = false;
                sendButton.disabled = false;
                statusText.textContent = 'Connected';
                
                let aiResponse = "";
                
                if (data.choices && data.choices.length > 0) {
                    aiResponse = data.choices[0].message.content;
                } else if (data.content) {
                    aiResponse = data.content;
                } else {
                    throw new Error('No response from AI');
                }
                
                // Add AI response
                addMessage(aiResponse, 'ai');
                
                // Update chat history
                chatHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: aiResponse }
                );
                
                // Keep history manageable
                if (chatHistory.length > 20) {
                    chatHistory = chatHistory.slice(-20);
                }
                
            } catch (error) {
                // Hide typing indicator
                typingIndicator.classList.remove('active');
                isProcessing = false;
                sendButton.disabled = false;
                statusDot.style.background = '#ef4444';
                statusText.textContent = 'Error';
                
                console.error('Error:', error);
                
                // Fallback response
                const fallbackResponse = getFallbackResponse(message);
                addMessage(fallbackResponse, 'ai');
                
                // Update chat history
                chatHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: fallbackResponse }
                );
                
                // Reset status after 3 seconds
                setTimeout(() => {
                    statusDot.style.background = '#10b981';
                    statusText.textContent = 'Connected';
                }, 3000);
            }
        }
        
        function getFallbackResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
                return "Hello! I'm Cyber AI. How can I help you with cybersecurity or programming today?";
            }
            
            if (msg.includes('python') || msg.includes('code') || msg.includes('program')) {
                return `üêç **Python Example:**\n\n\`\`\`python\n# Reverse a string function\ndef reverse_string(input_str):\n    """Reverse any string"""\n    return input_str[::-1]\n\n# Test it\nprint(reverse_string("cybersecurity"))  # ytirucesrebyc\n\`\`\`\n\nI can help you with more Python examples. What specific problem are you trying to solve?`;
            }
            
            if (msg.includes('cyber') || msg.includes('security') || msg.includes('hack')) {
                return `üîê **Cybersecurity Basics:**\n\n1. **Strong Passwords** - Use password manager\n2. **Two-Factor Authentication** - Enable everywhere\n3. **Regular Updates** - Patch all software\n4. **Backup Data** - Follow 3-2-1 rule\n5. **Phishing Awareness** - Verify before clicking\n\nNeed more specific cybersecurity guidance?`;
            }
            
            if (msg.includes('ai') || msg.includes('artificial') || msg.includes('machine')) {
                return "ü§ñ **AI Topics:**\n\n‚Ä¢ Machine Learning algorithms\n‚Ä¢ Neural networks & deep learning\n‚Ä¢ Natural language processing\n‚Ä¢ Computer vision\n‚Ä¢ AI ethics and governance\n\nWhat aspect of AI interests you most?";
            }
            
            return "I'm Cyber AI, created by 'The World of Cybersecurity'. I specialize in helping with:\n\n‚Ä¢ Programming (Python, JavaScript, etc.)\n‚Ä¢ Cybersecurity best practices\n‚Ä¢ AI and machine learning concepts\n‚Ä¢ Technology troubleshooting\n\nHow can I assist you? (Enhanced response mode)";
        }
        
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const avatarIcon = sender === 'user' ? 'fas fa-user' : 'fas fa-robot';
            
            messageDiv.innerHTML = `
                <div class="avatar ${sender}">
                    <i class="${avatarIcon}"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">${formatText(text)}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function formatText(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/üêç/g, 'üêç ')
                .replace(/üîê/g, 'üîê ')
                .replace(/ü§ñ/g, 'ü§ñ ');
        }
        
        function startNewChat() {
            if (confirm('Start a new chat? Current conversation will be cleared.')) {
                // Clear messages except welcome
                const messages = messagesContainer.querySelectorAll('.message');
                messages.forEach(msg => msg.remove());
                
                // Show welcome container
                welcomeContainer.style.display = 'block';
                
                // Clear history
                chatHistory = [];
                
                // Reset input
                userInput.value = '';
                userInput.style.height = 'auto';
                userInput.focus();
                
                // Show new greeting
                setTimeout(() => {
                    addMessage("Hello! I'm Cyber AI. I've started a new chat session. How can I help you today?", 'ai');
                }, 500);
            }
        }
    </script>
</body>
</html>
